# Webæ¡Œé¢ç³»ç»Ÿä»£ç†åŠŸèƒ½ä½¿ç”¨æŒ‡å—

## åŠŸèƒ½æ¦‚è¿°

Webæ¡Œé¢ç³»ç»Ÿå·²é›†æˆä»£ç†åŠŸèƒ½ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿé€šè¿‡æœ¬åœ°ä»£ç†æœåŠ¡å™¨è®¿é—®å¤–éƒ¨ç½‘ç«™ï¼Œè§£å†³äº†iframeçš„CORSé™åˆ¶å’Œè·¨åŸŸé—®é¢˜ã€‚

## ç³»ç»Ÿæ¶æ„

```
ç”¨æˆ· â†’ Webæ¡Œé¢ç³»ç»Ÿ â†’ æµè§ˆå™¨åº”ç”¨ â†’ ä»£ç†æœåŠ¡å™¨ â†’ å¤–éƒ¨ç½‘ç«™
     (localhost:8080)  (iframe)    (localhost:9999)  (internet)
```

## å¯åŠ¨æ–¹å¼

### æ–¹å¼ä¸€ï¼šè‡ªåŠ¨å¯åŠ¨è„šæœ¬
```bash
python3 start_servers.py
```
è‡ªåŠ¨å¯åŠ¨webæœåŠ¡å™¨(8080)å’Œä»£ç†æœåŠ¡å™¨(9999)

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨å¯åŠ¨
```bash
# å¯åŠ¨webæœåŠ¡å™¨
python3 -m http.server 8080 &

# å¯åŠ¨ä»£ç†æœåŠ¡å™¨
python3 simple_proxy.py &
```

### æ–¹å¼ä¸‰ï¼šä½¿ç”¨åŸç‰ˆä»£ç†
```bash
# å¯åŠ¨åŠŸèƒ½æ›´å®Œæ•´çš„ä»£ç†æœåŠ¡å™¨
python3 proxy_server.py &
```

## åŠŸèƒ½ç‰¹æ€§

### ğŸŒ ä»£ç†æ ¸å¿ƒåŠŸèƒ½
- âœ… **CORSè§£å†³æ–¹æ¡ˆ**: è§£å†³è·¨åŸŸè®¿é—®é™åˆ¶
- âœ… **é“¾æ¥ä¿®å¤**: è‡ªåŠ¨ä¿®å¤ç›¸å¯¹è·¯å¾„ä¸ºç»å¯¹è·¯å¾„
- âœ… **å­—ç¬¦ç¼–ç æ”¯æŒ**: è‡ªåŠ¨æ£€æµ‹å’Œè½¬æ¢å¤šç§å­—ç¬¦ç¼–ç 
- âœ… **å®‰å…¨è®¿é—®**: é€šè¿‡æœ¬åœ°ä»£ç†å®‰å…¨è®¿é—®å¤–éƒ¨ç½‘ç«™
- âœ… **é“¾æ¥æ‹¦æˆª**: è‡ªåŠ¨æ‹¦æˆªé¡µé¢å†…é“¾æ¥ç‚¹å‡»

### ğŸ–¥ï¸ æµè§ˆå™¨é›†æˆåŠŸèƒ½
- âœ… **ä»£ç†çŠ¶æ€æŒ‡ç¤ºå™¨**: å®æ—¶æ˜¾ç¤ºä»£ç†æœåŠ¡å™¨çŠ¶æ€
- âœ… **è‡ªåŠ¨ä»£ç†åˆ‡æ¢**: å¤–éƒ¨é“¾æ¥è‡ªåŠ¨ä½¿ç”¨ä»£ç†
- âœ… **æ¶ˆæ¯é€šä¿¡**: iframeä¸ä¸»çª—å£çš„æ¶ˆæ¯ä¼ é€’
- âœ… **å†å²è®°å½•**: æ”¯æŒå‰è¿›/åé€€åŠŸèƒ½
- âœ… **é”™è¯¯å¤„ç†**: ä¼˜é›…çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ

## ä½¿ç”¨æ–¹æ³•

### 1. å¯åŠ¨ç³»ç»Ÿ
```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd testwebos

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
python3 start_servers.py
```

### 2. è®¿é—®æ¡Œé¢ç³»ç»Ÿ
åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€: `http://localhost:8080`

### 3. ä½¿ç”¨æµè§ˆå™¨åº”ç”¨
1. ç‚¹å‡»æ¡Œé¢ä¸Šçš„"æµè§ˆå™¨"å›¾æ ‡
2. ç­‰å¾…ä»£ç†çŠ¶æ€æ˜¾ç¤ºä¸º"ä»£ç†å·²å¯ç”¨"
3. åœ¨åœ°å€æ è¾“å…¥ä»»æ„ç½‘å€ï¼Œå¦‚ï¼š
   - `baidu.com`
   - `google.com`
   - `github.com`
   - `stackoverflow.com`

### 4. ä»£ç†çŠ¶æ€è¯´æ˜
- **ğŸŸ¢ ä»£ç†å·²å¯ç”¨**: ä»£ç†æœåŠ¡å™¨æ­£å¸¸è¿è¡Œ
- **ğŸŸ¡ æ£€æŸ¥ä¸­...**: æ­£åœ¨æ£€æŸ¥ä»£ç†çŠ¶æ€
- **ğŸ”´ ä»£ç†ç¦»çº¿**: ä»£ç†æœåŠ¡å™¨æœªå¯åŠ¨
- **ğŸ”´ ä»£ç†é”™è¯¯**: ä»£ç†çŠ¶æ€æ£€æŸ¥å¤±è´¥

## æŠ€æœ¯å®ç°

### ä»£ç†æœåŠ¡å™¨ (simple_proxy.py)
```python
# ä»£ç†URLæ ¼å¼
http://localhost:9999/proxy?url=ç›®æ ‡ç½‘å€

# ç¤ºä¾‹
http://localhost:9999/proxy?url=https://www.baidu.com
```

### æµè§ˆå™¨åº”ç”¨é›†æˆ
```javascript
// è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦ä½¿ç”¨ä»£ç†
shouldUseProxy(url) {
    // æœ¬åœ°åœ°å€ä¸ä½¿ç”¨ä»£ç†
    if (url.includes('localhost')) return false;
    
    // å¤–éƒ¨HTTP/HTTPSåœ°å€ä½¿ç”¨ä»£ç†
    return url.startsWith('http://') || url.startsWith('https://');
}

// æ„å»ºä»£ç†URL
getProxyUrl(url) {
    return `http://localhost:9999/proxy?url=${encodeURIComponent(url)}`;
}
```

## æµ‹è¯•æ–¹æ³•

### åŸºç¡€åŠŸèƒ½æµ‹è¯•
```bash
# æµ‹è¯•ä»£ç†æœåŠ¡å™¨çŠ¶æ€
curl http://localhost:9999

# æµ‹è¯•ä»£ç†åŠŸèƒ½
curl "http://localhost:9999/proxy?url=https://httpbin.org/json"
```

### æµè§ˆå™¨æµ‹è¯•
1. æ‰“å¼€Webæ¡Œé¢ç³»ç»Ÿ
2. å¯åŠ¨æµè§ˆå™¨åº”ç”¨
3. æµ‹è¯•è®¿é—®ä»¥ä¸‹ç½‘ç«™ï¼š
   - ç™¾åº¦: `baidu.com`
   - Google: `google.com`
   - GitHub: `github.com`
   - æ–°é—»ç½‘ç«™: `news.ycombinator.com`

### ä»£ç†çŠ¶æ€æµ‹è¯•
1. ä»£ç†æœåŠ¡å™¨è¿è¡Œæ—¶ â†’ çŠ¶æ€æ˜¾ç¤º"ä»£ç†å·²å¯ç”¨"
2. åœæ­¢ä»£ç†æœåŠ¡å™¨ â†’ çŠ¶æ€æ˜¾ç¤º"ä»£ç†ç¦»çº¿"
3. é‡å¯ä»£ç†æœåŠ¡å™¨ â†’ çŠ¶æ€è‡ªåŠ¨æ¢å¤

## é…ç½®é€‰é¡¹

### ä»£ç†æœåŠ¡å™¨é…ç½®
- **ç«¯å£**: 9999 (å¯åœ¨ä»£ç ä¸­ä¿®æ”¹)
- **è¶…æ—¶æ—¶é—´**: 10ç§’
- **ç”¨æˆ·ä»£ç†**: æ¨¡æ‹ŸChromeæµè§ˆå™¨
- **å­—ç¬¦ç¼–ç **: è‡ªåŠ¨æ£€æµ‹utf-8, gbk, gb2312

### æµè§ˆå™¨åº”ç”¨é…ç½®
- **çŠ¶æ€æ£€æŸ¥é—´éš”**: 10ç§’
- **ä»£ç†æ£€æµ‹æ–¹å¼**: HTTP HEADè¯·æ±‚
- **é”™è¯¯é‡è¯•**: è‡ªåŠ¨é‡è¯•æœºåˆ¶

## æ•…éšœæ’é™¤

### é—®é¢˜1: ä»£ç†çŠ¶æ€æ˜¾ç¤º"ä»£ç†ç¦»çº¿"
**è§£å†³æ–¹æ¡ˆ:**
```bash
# æ£€æŸ¥ä»£ç†æœåŠ¡å™¨è¿›ç¨‹
ps aux | grep simple_proxy.py

# é‡å¯ä»£ç†æœåŠ¡å™¨
python3 simple_proxy.py &
```

### é—®é¢˜2: ç½‘é¡µæ— æ³•åŠ è½½
**å¯èƒ½åŸå› :**
- ç›®æ ‡ç½‘ç«™æ‹’ç»ä»£ç†è®¿é—®
- ç½‘ç»œè¿æ¥é—®é¢˜
- ä»£ç†æœåŠ¡å™¨è¶…æ—¶

**è§£å†³æ–¹æ¡ˆ:**
```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping google.com

# æ£€æŸ¥ä»£ç†æœåŠ¡å™¨æ—¥å¿—
# æŸ¥çœ‹ç»ˆç«¯è¾“å‡ºçš„é”™è¯¯ä¿¡æ¯
```

### é—®é¢˜3: é¡µé¢æ˜¾ç¤ºä¹±ç 
**è§£å†³æ–¹æ¡ˆ:**
- ä»£ç†æœåŠ¡å™¨ä¼šè‡ªåŠ¨å°è¯•å¤šç§å­—ç¬¦ç¼–ç 
- å¦‚ä»æœ‰é—®é¢˜ï¼Œå¯æ‰‹åŠ¨æŒ‡å®šç¼–ç 

### é—®é¢˜4: é“¾æ¥ç‚¹å‡»æ— ååº”
**åŸå› :** æŸäº›ç½‘ç«™çš„JavaScriptå¯èƒ½ä¸ä»£ç†è„šæœ¬å†²çª
**è§£å†³æ–¹æ¡ˆ:** ç›´æ¥åœ¨åœ°å€æ è¾“å…¥ç›®æ ‡URL

## å®‰å…¨æ³¨æ„äº‹é¡¹

### âœ… å®‰å…¨ç‰¹æ€§
- æœ¬åœ°ä»£ç†ï¼Œæ•°æ®ä¸ç»è¿‡ç¬¬ä¸‰æ–¹
- å¿½ç•¥SSLè¯ä¹¦éªŒè¯(ä»…é™å¼€å‘ç¯å¢ƒ)
- è‡ªåŠ¨è¿‡æ»¤æ¶æ„è„šæœ¬
- æ²™ç®±iframeéš”ç¦»

### âš ï¸ æ³¨æ„äº‹é¡¹
- ä»…é€‚ç”¨äºå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒ
- ä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨
- æŸäº›ç½‘ç«™å¯èƒ½æ£€æµ‹å¹¶é˜»æ­¢ä»£ç†è®¿é—®
- æ•æ„Ÿæ•°æ®è®¿é—®éœ€è°¨æ…

## é«˜çº§åŠŸèƒ½

### è‡ªå®šä¹‰ä»£ç†è§„åˆ™
å¯ä»¥ä¿®æ”¹`shouldUseProxy`æ–¹æ³•æ¥è‡ªå®šä¹‰å“ªäº›URLä½¿ç”¨ä»£ç†ï¼š

```javascript
shouldUseProxy(url) {
    // è‡ªå®šä¹‰è§„åˆ™
    const noProxyDomains = ['localhost', '127.0.0.1', 'example.com'];
    const forceProxyDomains = ['blocked-site.com'];
    
    // æ£€æŸ¥æ˜¯å¦åœ¨æ’é™¤åˆ—è¡¨ä¸­
    if (noProxyDomains.some(domain => url.includes(domain))) {
        return false;
    }
    
    // æ£€æŸ¥æ˜¯å¦åœ¨å¼ºåˆ¶ä»£ç†åˆ—è¡¨ä¸­
    if (forceProxyDomains.some(domain => url.includes(domain))) {
        return true;
    }
    
    // é»˜è®¤è§„åˆ™
    return url.startsWith('http://') || url.startsWith('https://');
}
```

### ä»£ç†ç¼“å­˜
å¯ä»¥åœ¨ä»£ç†æœåŠ¡å™¨ä¸­æ·»åŠ ç¼“å­˜åŠŸèƒ½æ¥æé«˜æ€§èƒ½ï¼š

```python
# åœ¨simple_proxy.pyä¸­æ·»åŠ ç¼“å­˜
import time

cache = {}
CACHE_EXPIRE = 300  # 5åˆ†é’Ÿ

def get_cached_content(url):
    if url in cache:
        content, timestamp = cache[url]
        if time.time() - timestamp < CACHE_EXPIRE:
            return content
    return None

def cache_content(url, content):
    cache[url] = (content, time.time())
```

## è´¡çŒ®å’Œåé¦ˆ

å¦‚æœåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œè¯·ï¼š
1. æ£€æŸ¥æœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
2. æŸ¥çœ‹ç»ˆç«¯è¾“å‡ºçš„é”™è¯¯ä¿¡æ¯
3. æä¾›è¯¦ç»†çš„é—®é¢˜æè¿°å’Œå¤ç°æ­¥éª¤

## æ€»ç»“

Webæ¡Œé¢ç³»ç»Ÿçš„ä»£ç†åŠŸèƒ½ä¸ºç”¨æˆ·æä¾›äº†ï¼š
- ğŸŒ **æ— ç¼æµè§ˆä½“éªŒ**: åœ¨æ¡Œé¢ç¯å¢ƒä¸­è®¿é—®ä»»æ„ç½‘ç«™
- ğŸ›¡ï¸ **å®‰å…¨ä»£ç†è®¿é—®**: è§£å†³è·¨åŸŸå’Œå®‰å…¨é™åˆ¶
- ğŸ“Š **å®æ—¶çŠ¶æ€ç›‘æ§**: ç›´è§‚çš„ä»£ç†çŠ¶æ€æ˜¾ç¤º
- ğŸ”§ **æ˜“äºé…ç½®**: ç®€å•çš„å¯åŠ¨å’Œé…ç½®è¿‡ç¨‹

é€šè¿‡ä»£ç†åŠŸèƒ½ï¼ŒWebæ¡Œé¢ç³»ç»ŸçœŸæ­£å®ç°äº†å®Œæ•´çš„æ¡Œé¢æµè§ˆä½“éªŒï¼ 